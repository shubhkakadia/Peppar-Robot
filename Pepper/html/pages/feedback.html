<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- <meta charset="UTF-8" /> -->
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge" /> -->
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" /> -->
    <meta name="viewport" content="width=1280, user-scalable=no" />
    <title>Feedback</title> 
    <link
      rel="stylesheet"
      href="../css/feedback.css"
      media="screen"
      type="text/css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />

    <svg xmlns="http://www.w3.org/2000/svg" style="display: none">
      <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path
          d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"
        />
      </symbol>
    </svg>
  </head>
  <body>
    <div>
      <div>
        <img src="../assets/header.png" height="160px" width="auto">
    </div>
      <div>
        <button id="backbtn" onclick="window.location.href='menu.html'">
          Go Back
        </button>
      </div>
      <div>
        <button id="homebtn" onclick="window.location.href='menu.html'">
          Go Home
        </button>
      </div>
      <div class="items">
        <div class="mb-3 name">
          <label>Input your name (Optional)</label>
          <input id="Name" class="form-control" placeholder="name" />
        </div>
      </div>
      <div class="items">
        <div class="mb-3 name">
          <label for="services">Select Service (Required)</label>
          <select class="form-select" id="ServiceType" name="services">
            <option value="" selected>No Service</option>
            <option value="NDIS (Occupational Therapy)">NDIS (Occupational Therapy)</option>
            <option value="NDIS (Physiotherapy)">NDIS (Physiotherapy)</option>
            <option value="NDIS (Podiatry)">NDIS (Podiatry)</option>
            <option value="NDIS (Exercise Physiology)">NDIS (Exercise Physiology)</option>
            <option value="NDIS (Speeech Pathology)">NDIS (Speeech Pathology)y</option>
            <option value="NDIS (Dietics)">NDIS (Dietics)</option>
            <option value="Childrens Health (Occupational Therapy)">Childrens Health (Occupational Therapy)</option>
            <option value="Childrens Health (Physiotherapy)">Childrens Health (Physiotherapy)</option>
            <option value="Childrens Health (Podiatryy)">Childrens Health (Podiatry)</option>
            <option value="Childrens Health (Exercise Physiology)">Childrens Health (Exercise Physiology)</option>
            <option value="Childrens Health (Speeech Pathology)">Childrens Health (Speeech Pathology)</option>
            <option value="Health Ageing (Physiotherapy)">Health Ageing (Physiotherapy)</option>
            <option value="Health Ageing (Exercise Physiology)">Health Ageing (Exercise Physiology)</option>
            <option value="Health Ageing (Dietetics)">Health Ageing (Dietetics)</option>
            <option value="Rehabilitation Health (Physiotherapy)">Rehabilitation Health (Physiotherapy)</option>
            <option value="Rehabilitation Health (Exercise Physiology)">Rehabilitation Health (Exercise Physiology)</option>
            <option value="Rehabilitation Health (Occupational Therapy)">Rehabilitation Health (Occupational Therapy)</option>
            <option value="Rehabilitation Health (Podiatry)">Rehabilitation Health (Podiatry)</option>
            <option value="Rehabilitation Health (Dietetics)">Rehabilitation Health (Dietetics)</option>
            <option value="Sports Health (Physiotherapy)">Sports Health (Physiotherapy)</option>
            <option value="Sports Health (Exercise Physiology)">Sports Health (Physiotherapy)</option>
            <option value="Sports Health (High Performance )">Sports Health (Physiotherapy)</option>
            <option value="Sports Health (Dietetics)">Sports Health (Physiotherapy)</option>
            <option value="Sports Health (Podiatry)">Sports Health (Podiatry)</option>
          </select>
        </div>
      </div>
      <div class="items">
        <div class="name">
          <label>Comments (Optional)</label>
          <textarea
            class="form-control"
            placeholder="Leave a comment here"
            id="Comment"
          ></textarea>
        </div>
      </div>
      <div class="items">
        <div class="image-row">
          <img src="../assets/1star.png" onclick="setValue(1)" />
          <img src="../assets/2star.png" onclick="setValue(2)" />
          <img src="../assets/3star.png" onclick="setValue(3)" />
          <img src="../assets/4star.png" onclick="setValue(4)" />
          <img src="../assets/5star.png" onclick="setValue(5)" />
        </div>
      </div>
    </div>

    <div class="container">
      <div>
        <img src="../assets/pepperHeadIcon.png" style="width: 30% ;height: 30% ; float:right;">
      </div>
      <div class="bubble left">
        Let us know how we did! You don't have to tell me your name but do <b>remember to select the service you received</b>!
      </div>


    </div>

    <!-- <script src="https://webdemo.aldebaran.com/libs/2.5.5/pepperjs/pepperjs-1.0.0.min.js"></script> -->
    <!-- <script src="/libs/qimessaging/2/qimessaging.js"></script> -->
    <script src="../js/robotutils.js"></script>
    <script src="../js/feedback.js"></script>

    <!-- <script>
      // session = null;
      // QiSession(connected, disconnected, location.host);

      // Pepper.connect({
      //   success: function (session) {
      //     console.log("Pepper connected successfully");
      //   },
      //   error: function () {
      //     console.log("Error connecting to Pepper");
      //   },
      // });
      // function connected(s) {
      //   console.log("Session Connected");
      //   session = s;
      // }

      // function disconnect(error) {
      //   console.log("Session Disconnected");
      // }

      var fetchData = null;
      var currentDate = new Date();
      var currentYear = currentDate.getYear() + 1900;
      function FetchAPI() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "http://192.168.0.115:3000/feedback/get", true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            fetchData = JSON.parse(xhr.responseText).response;
            console.log(fetchData);
            // fetchData = fetchData.response;
          }
        };
        xhr.send(null);
      }
      FetchAPI();
      function setValue(ratingvalue) {
        const QiSession = require("naoqi").QiSession;
        const session = new QiSession("192.168.0.160");

        console.log("session", session);
        // specify what services will be used later
        session.using("ALTextToSpeech", "tts");
        session.using("ALBehaviorManager");

        // start programming on this trigger
        session.onload = function (loaded) {
          assert.deepEqual(this, session);
          this.tts.say("hello naoqi");
          this.behaviorManager.run("behavir path").then(() => {
            // get result from run
          });

          // register an event
          this.subscribe("robotIsWakeUp", (awake) => {
            console.log("when robot is wake up");
          });
        };

        // switch(ratingvalue){
        //   case 1:
        // }

        var Name = document.getElementById("Name").value;
        var ServiceType = document.getElementById("ServiceType").value;
        var Comments = document.getElementById("Comment").value;
        if (ServiceType !== "") {
          function generateID() {
            console.log(fetchData);
            if (fetchData.length < 1) {
              ID = (currentYear - 2000) * 10000;
              console.log(ID);
              return ID + 1;
            } else {
              return fetchData[fetchData.length - 1].ID + 1;
            }
          }
          function generateJSON() {
            var ID = generateID();
            var Conversation = [];
            var feedbackData = {
              ID: ID,
              Name: Name,
              ServiceType: ServiceType,
              Comments: Comments,
              Rating: ratingvalue,
              Conversation: Conversation,
            };
            console.log("feedbackData", feedbackData);
            return feedbackData;
          }
          function post_req() {
            var xhr = new XMLHttpRequest();
            var url = "http://192.168.0.115:3000/feedback/register";
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
              if (xhr.readyState == 4 && xhr.status == 200) {
                console.log(xhr.responseText);
              }
            };
            var data = JSON.stringify(generateJSON());
            xhr.send(data);
          }
          FetchAPI();
          post_req();
          var customAlert = document.createElement("div");
          customAlert.className = "custom-alert";
          customAlert.innerHTML =
            '<div class="alert alert-success d-flex align-items-center" role="alert">' +
            '<svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>' +
            "<div>" +
            "Thank you for your feedback! Redirecting you to the Menu." +
            "</div>" +
            "</div>";
          document.body.appendChild(customAlert);
          // Set custom alert position to top of page
          customAlert.style.position = "fixed";
          customAlert.style.top = "0";
          customAlert.style.left = "34.5%";
          customAlert.style.opacity = "80%";

          // +var tts = new ALProxy("ALTextToSpeech", "192.168.0.160", 9559); // replace "your-pepper-robot-ip-address" with the IP address of your Pepper robot

          // session.say("Thank you for your feedback");

          // sayThankYou();
          setTimeout(function () {
            window.location.href = "menu.html";
          }, 3000);
        }
      }
    </> -->

    <!-- <script src="/libs/qi/2/qi.js"></> -->
    <!-- <script src="../js/jquery-1.11.0.min.js"></> -->
    <!-- <script src="../js/feedback.js" type="text/javascript"></script> -->
  </body>
</html>
